# About the project

This multidisciplinary project had us (Aberystwyth University) collaborate with the Royal Agricultural University to build an algorithm which detects blinks in horses and classifies them into full blinks, half blinks and tremors. This project is on-going, but we did present a paper on UKCI2021, thus securing a spot in the conference's proceedings. They are not yet published but we are working on an expanded version of the paper where we use a pose estimation approach through DeepLabCut and compare the results to this Python script. Blinkrate in horses is an important biomarker as it is connected to dopamine levels which can reveal health conditions in horses. The curent progress of this project was submitted to UKCI 2022 and was published in the conference proceedings available here: https://link.springer.com/chapter/10.1007/978-3-031-55568-8_37


# SD-Version1

This repository hosts all code necessary for the Horse Blink Project.
orseblink_improved_v2_OTA.py - This file is an improved version of the horseblink detection code co-authored by Otar and myself.

## Setting up:

You need to create a folder on your Desktop called Horseblink. Inside, create three folders: code, videos, data. You want to put the file called Emily_completed.py file in the folder called 'code'. In the videos folder make sure to put all of your Horse videos. The data folder is where the CSV files will be saved once you run the code for a video.

## System requirements:

In order to run the code you need, a distribution of the scientific environment for Python - Spyder (distributed by Anaconda) and the following libraries/modules. Some of them will already come with your distribution of Spyder so it is a matter of just importing them:

* opencv-contrib-python
* tkinter
* numpy
* matplotlib
* csv
* pandas
* datetime (timedelta)

## Running the algorithm:

* User unput:

Before you run the algorithm, there are a few parameters that rely on user input. If you don't change these parameters, you will be prompted to select a video and the program will run for the entirety of its duration. The parameters taking user input are:

```
startframe
```
In case you wanted to run a specific section of the video you can change this variable to the frame number you would like to start from. The default value of this is 1 (first frame).

```
stopframe
```
In case you wanted to run a specific section of the video you can change this variable to the frame number you would like to stop at. The default value of this is last frame - 10 frames (the algorithm often buffers on the very last frame hence the measure)

```
desiredvideo
```
This variable takes input of either 0 or 1, respectively 0 meaning that you would like to run a video anew, 1 meaning that you wish to plot the signal of a video that you have ran before. Upon selecting 0 a prompt window will open where you will chose your video you would like to run. Upon selecting 1, a prompt window will open where you should select the *file_name* Signal.csv of the video you would like to run. The default value of this is 0.

The algorithm won't limit you to 60 frames, but it is advised that you run at least 60 frames of a video in order for the background substraction algorithm to be accurate. This is a warning that will show up in the console if you chose to run a video for less than 60 seconds.

```
The graph
```
Once the video is ran, a graph with the signal will be plotted. On this graph you are to chose the threshold. Upon clicking on the graph a red line will appear to illustrate where you have placed the threshold (you should attempt to click at your desired amplitude).

* Outputs:

Once you have selected your threshold, the rest of the program will run within seconds and your outputs will be ready.

* **file_name + Variables.csv** - This file contains the variables you have used for the video: startframe, stopframe, amp_threshold, frame_threshold
* **file_name + Signal.csv** - This file contains the Raw, filtered and background signal for each frame of a video that you have ran, plus the coordinates of the selected ROI (region of interest)
* **file_name + Evaluation.csv** - This is the file with the highest importance to you. It contains the frames of the blinks (start and stop frame), the duration in microseconds and the average interval between blinks throughout the video.

* Notes:

- If you rerun a video, the files will be replaced with new files containing the new results. That means you will always have the most recent rerun and therefore the most recent versions of the 3 files above. 



